import{createComponent as p,isServer as P,getRequestEvent as A,delegateEvents as G,ssrElement as k,escape as b,mergeProps as V,ssr as y,ssrHydrationKey as $,ssrStyle as q,useAssets as Y,NoHydration as H,HydrationScript as Q,ssrAttribute as X,Hydration as Z,renderToStream as ee}from"solid-js/web";import{toWebRequest as te,getRequestIP as ne,setResponseHeader as T,setResponseStatus as C,appendResponseHeader as re,getResponseHeader as se,removeResponseHeader as oe,getCookie as ae,setCookie as ie,eventHandler as ce,sendRedirect as le,setHeader as ue}from"h3";import{children as de,createMemo as x,on as me,createRoot as he,Show as j,createSignal as pe,onCleanup as D,lazy as fe,createComponent as ge,Suspense as be,ErrorBoundary as ye,createEffect as we}from"solid-js";import{c as ve,a as Se,R as Re,g as Ee,b as $e,d as Ae,e as B}from"./assets/routing-29e90f70.js";import{provideRequestEvent as ke}from"solid-js/web/storage";const U=e=>t=>{const{base:n}=t,r=de(()=>t.children),s=x(()=>ve(t.root?{component:t.root,children:r()}:r(),t.base||"")),a=Se(e,s,{base:n});return e.create&&e.create(a),p(Re.Provider,{value:a,get children(){return p(Te,{routerState:a,get branches(){return s()}})}})};function Te(e){const t=x(()=>Ee(e.branches,e.routerState.location.pathname));if(P){const o=A();o&&(o.routerMatches||(o.routerMatches=[])).push(t().map(({route:i,path:l,params:h})=>({path:i.originalPath,pattern:i.pattern,match:l,params:h,metadata:i.metadata})))}const n=$e(()=>{const o=t(),i={};for(let l=0;l<o.length;l++)Object.assign(i,o[l].params);return i}),r=[];let s;const a=x(me(t,(o,i,l)=>{let h=i&&o.length===i.length;const g=[];for(let d=0,S=o.length;d<S;d++){const w=i&&i[d],u=o[d];l&&w&&u.route.key===w.route.key?g[d]=l[d]:(h=!1,r[d]&&r[d](),he(c=>{r[d]=c,g[d]=Ae(e.routerState,g[d-1]||e.routerState.base,Ce(()=>a()[d+1]),()=>t()[d],n)}))}return r.splice(o.length).forEach(d=>d()),l&&h?l:(s=g[0],g)}));return p(j,{get when(){return a()&&s},keyed:!0,children:o=>p(B.Provider,{value:o,get children(){return o.outlet()}})})}const Ce=e=>()=>p(j,{get when(){return e()},keyed:!0,children:t=>p(B.Provider,{value:t,get children(){return t.outlet()}})});function xe([e,t],n,r){return[n?()=>n(e()):e,r?s=>t(r(s)):t]}function Le(e){if(e==="#")return null;try{return document.querySelector(e)}catch{return null}}function Pe(e){let t=!1;const n=s=>typeof s=="string"?{value:s}:s,r=xe(pe(n(e.get()),{equals:(s,a)=>s.value===a.value}),void 0,s=>(!t&&e.set(s),s));return e.init&&D(e.init((s=e.get())=>{t=!0,r[1](n(s)),t=!1})),U({signal:r,create:e.create,utils:e.utils})}function Me(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function Oe(e,t){const n=Le(`#${e}`);n?n.scrollIntoView():t&&window.scrollTo(0,0)}function qe(e){const t=new URL(e);return t.pathname+t.search}function Fe(e){let t;const n={value:e.url||(t=A())&&qe(t.request.url)||""};return U({signal:[()=>n,r=>Object.assign(n,r)]})(e)}const Ie=new Map;function Ne(e=!0,t=!1,n="/_server"){return r=>{const s=r.base.path(),a=r.navigatorFactory(r.base);let o={};function i(u){return u.namespaceURI==="http://www.w3.org/2000/svg"}function l(u){if(u.defaultPrevented||u.button!==0||u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)return;const c=u.composedPath().find(O=>O instanceof Node&&O.nodeName.toUpperCase()==="A");if(!c||t&&!c.getAttribute("link"))return;const f=i(c),m=f?c.href.baseVal:c.href;if((f?c.target.baseVal:c.target)||!m&&!c.hasAttribute("state"))return;const v=(c.getAttribute("rel")||"").split(/\s+/);if(c.hasAttribute("download")||v&&v.includes("external"))return;const R=f?new URL(m,document.baseURI):new URL(m);if(!(R.origin!==window.location.origin||s&&R.pathname&&!R.pathname.toLowerCase().startsWith(s.toLowerCase())))return[c,R]}function h(u){const c=l(u);if(!c)return;const[f,m]=c,M=r.parsePath(m.pathname+m.search+m.hash),v=f.getAttribute("state");u.preventDefault(),a(M,{resolve:!1,replace:f.hasAttribute("replace"),scroll:!f.hasAttribute("noscroll"),state:v&&JSON.parse(v)})}function g(u){const c=l(u);if(!c)return;const[f,m]=c;o[m.pathname]||r.preloadRoute(m,f.getAttribute("preload")!=="false")}function d(u){const c=l(u);if(!c)return;const[f,m]=c;o[m.pathname]||(o[m.pathname]=setTimeout(()=>{r.preloadRoute(m,f.getAttribute("preload")!=="false"),delete o[m.pathname]},200))}function S(u){const c=l(u);if(!c)return;const[,f]=c;o[f.pathname]&&(clearTimeout(o[f.pathname]),delete o[f.pathname])}function w(u){let c=u.submitter&&u.submitter.hasAttribute("formaction")?u.submitter.formAction:u.target.action;if(!c)return;if(!c.startsWith("action:")){const m=new URL(c);if(c=r.parsePath(m.pathname+m.search),!c.startsWith(n))return}if(u.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const f=Ie.get(c);if(f){u.preventDefault();const m=new FormData(u.target);f.call(r,m)}}G(["click","submit"]),document.addEventListener("click",h),e&&(document.addEventListener("mouseover",d),document.addEventListener("mouseout",S),document.addEventListener("focusin",g),document.addEventListener("touchstart",g)),document.addEventListener("submit",w),D(()=>{document.removeEventListener("click",h),e&&(document.removeEventListener("mouseover",d),document.removeEventListener("mouseout",S),document.removeEventListener("focusin",g),document.removeEventListener("touchstart",g)),document.removeEventListener("submit",w)})}}function He(e){return P?Fe(e):Pe({get:()=>({value:window.location.pathname+window.location.search+window.location.hash,state:history.state}),set({value:t,replace:n,scroll:r,state:s}){n?window.history.replaceState(s,"",t):window.history.pushState(s,"",t),Oe(window.location.hash.slice(1),r)},init:t=>Me(window,"popstate",()=>t()),create:Ne(e.preload,e.explicitLinks,e.actionBase),utils:{go:t=>window.history.go(t)}})(e)}const je=" ",De={style:e=>k("style",e.attrs,()=>b(e.children),!0),link:e=>k("link",e.attrs,void 0,!0),script:e=>e.attrs.src?k("script",V(()=>e.attrs,{get id(){return e.key}}),()=>y(je),!0):null};function L(e){let{tag:t,attrs:{key:n,...r}={key:void 0},children:s}=e;return De[t]({attrs:r,key:n,children:s})}function Be(e,t,n,r="default"){return fe(async()=>{{const a=(await e.import())[r],i=(await t.inputs?.[e.src].assets()).filter(h=>h.tag==="style"||h.attrs.rel==="stylesheet");return{default:h=>[...i.map(g=>L(g)),ge(a,h)]}}})}const _=[{type:"page",$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("./index.js"),import:()=>import("./index.js")},path:"/",filePath:"D:/ani-rec/src/routes/index.tsx"},{type:"page",$component:{src:"src/routes/recommendations.tsx?pick=default&pick=$css",build:()=>import("./recommendations.js"),import:()=>import("./recommendations.js")},path:"/recommendations",filePath:"D:/ani-rec/src/routes/recommendations.tsx"},{type:"page",$component:{src:"src/routes/[...404].tsx?pick=default&pick=$css",build:()=>import("./_...404_.js"),import:()=>import("./_...404_.js")},path:"/*404",filePath:"D:/ani-rec/src/routes/[...404].tsx"},{type:"page",$component:{src:"src/routes/[...loading].tsx?pick=default&pick=$css",build:()=>import("./_...loading_.js"),import:()=>import("./_...loading_.js")},path:"/*loading",filePath:"D:/ani-rec/src/routes/[...loading].tsx"},{type:"api",$GET:{src:"src/routes/api/get-anime.ts?pick=GET",build:()=>import("./get-anime.js"),import:()=>import("./get-anime.js")},$POST:{src:"src/routes/api/get-anime.ts?pick=POST",build:()=>import("./get-anime2.js"),import:()=>import("./get-anime2.js")},path:"/api/get-anime",filePath:"D:/ani-rec/src/routes/api/get-anime.ts"}],Ue=We(_.filter(e=>e.type==="page")),_e=Je(_.filter(e=>e.type==="api"));function Ke(e,t){const n=e.split("/").filter(Boolean);e:for(const r of _e){const s=r.matchSegments;if(n.length<s.length||!r.wildcard&&n.length>s.length)continue;for(let i=0;i<s.length;i++){const l=s[i];if(l&&n[i]!==l)continue e}const a=r[`$${t}`];if(a==="skip"||a===void 0)return;const o={};for(const{type:i,name:l,index:h}of r.params)i===":"?o[l]=n[h]:o[l]=n.slice(h).join("/");return{handler:a,params:o}}}function We(e){function t(n,r,s,a){const o=Object.values(n).find(i=>s.startsWith(i.id+"/"));return o?(t(o.children||(o.children=[]),r,s.slice(o.id.length)),n):(n.push({...r,id:s,path:s.replace(/\/\([^)/]+\)/g,"")}),n)}return e.sort((n,r)=>n.path.length-r.path.length).reduce((n,r)=>t(n,r,r.path,r.path),[])}function Je(e){return e.flatMap(t=>K(t.path).map(r=>({...t,path:r}))).map(ze).sort((t,n)=>n.score-t.score)}function K(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length);const s=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)s.push(n+=t[1]),r=r.slice(t[0].length);return K(r).reduce((a,o)=>[...a,...s.map(i=>i+o)],[])}function ze(e){const t=e.path.split("/").filter(Boolean),n=[],r=[];let s=0,a=!1;for(const[o,i]of t.entries())if(i[0]===":"){const l=i.slice(1);s+=3,n.push({type:":",name:l,index:o}),r.push(null)}else i[0]==="*"?(s-=1,n.push({type:"*",name:i.slice(1),index:o}),a=!0):(s+=4,r.push(i));return{...e,score:s,params:n,matchSegments:r,wildcard:a}}function W(){function e(n){return{...n,...n.$$route?n.$$route.require().route:void 0,metadata:{...n.$$route?n.$$route.require().route.metadata:{},filesystem:!0},component:Be(n.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:n.children?n.children.map(e):void 0}}return Ue.map(e)}let F;const Ge=()=>P?A().routes:F||(F=W());function Ve(){return p(He,{root:e=>p(be,{get children(){return e.children}}),get children(){return p(Ge,{})}})}const Ye=["<div",' style="padding:16px"><div style="','"><p style="font-weight:bold" id="error-message">','</p><button id="reset-errors" style="','">Clear errors and retry</button><pre style="margin-top:8px;width:100%">',"</pre></div></div>"];function Qe(e){return p(ye,{fallback:t=>p(Xe,{error:t}),get children(){return e.children}})}function Xe(e){return we(()=>console.error(e.error)),y(Ye,$(),q(`
          background-color: rgba(252, 165, 165);
          color: rgb(153, 27, 27);
          border-radius": 5px;
          overflow: scroll;
          padding: 16px;
          margin-bottom: 8px;
        `),b(e.error.message),q(`color: rgba(252, 165, 165);
            background-color: rgb(153, 27, 27);
            border-radius: 5px;
            padding: 4px 8px`),b(e.error.stack))}const Ze=["<script",">","<\/script>"],et=["<script",' type="module" async',"><\/script>"],tt=y("<!DOCTYPE html>");function nt(e){const t=A();let n=[];return Promise.resolve().then(async()=>{let r=t.routes;if(t.routerMatches&&t.routerMatches[0])for(let s=0;s<t.routerMatches[0].length;s++){const a=t.routerMatches[0][s];if(a.metadata&&a.metadata.filesystem){const o=r.find(h=>h.path===a.path),l=await globalThis.MANIFEST.client.inputs[o.$component.src].assets();n.push.apply(n,l),r=o.children}}n=[...new Map(n.map(s=>[s.attrs.key,s])).values()].filter(s=>s.attrs.rel==="modulepreload"&&!t.assets.find(a=>a.attrs.key===s.attrs.key))}),Y(()=>n.length?n.map(r=>L(r)):void 0),p(H,{get children(){return[tt,p(e.document,{get assets(){return[p(Q,{}),t.assets.map(r=>L(r))]},get scripts(){return[y(Ze,$(),`window.manifest = ${JSON.stringify(t.manifest)}`),y(et,$(),X("src",b(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return p(Z,{get children(){return p(Qe,{get children(){return p(Ve,{})}})}})}})]}})}const J=Symbol("h3Event"),E=Symbol("fetchEvent"),rt={get(e,t){return t===E?e:e[t]??e[J][t]}};function st(e){return new Proxy({request:te(e),clientAddress:ne(e),locals:{},[J]:e},rt)}function ot(e){if(!e[E]){const t=st(e);e[E]=t}return e[E]}function at(e){const t=ae(e,"flash");if(!t)return;let n=JSON.parse(t);if(!n||!n.result)return[];const r=[...n.input.slice(0,-1),new Map(n.input[n.input.length-1])];return ie(e,"flash","",{maxAge:0}),{url:n.url,result:n.error?new Error(n.result):n.result,input:r}}async function z(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,T(e,"Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],initialSubmission:at(e),routes:W(),components:{status:r=>(C(e,r.code,r.text),()=>C(e,200)),header:r=>(r.append?re(e,r.name,r.value):T(e,r.name,r.value),()=>{const s=se(e,r.name);if(s&&typeof s=="string"){const a=s.split(", "),o=a.indexOf(r.value);o!==-1&&a.splice(o,1),a.length?T(e,r.name,a.join(", ")):oe(e,r.name)}})},$islands:new Set})}function it(e,t={}){return ce({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:n=>{const r=ot(n);return ke(r,async()=>{const s=Ke(new URL(r.request.url).pathname,r.request.method);if(s){const d=(await s.handler.import())[r.request.method];return r.params=s.params,await d(r)}const a=await z(r);let o={...t};if(o.onCompleteAll){const g=o.onCompleteAll;o.onCompleteAll=d=>{N(a)(d),g(d)}}else o.onCompleteAll=N(a);if(o.onCompleteShell){const g=o.onCompleteShell;o.onCompleteShell=d=>{I(a,n)(),g(d)}}else o.onCompleteShell=I(a,n);const i=ee(()=>e(a),o);if(a.response&&a.response.headers.get("Location"))return le(r,a.response.headers.get("Location"));const{writable:l,readable:h}=new TransformStream;return i.pipeTo(l),h})}})}function I(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(C(t,302),ue(t,"Location",e.response.headers.get("Location")))}}function N(e){return({write:t})=>{const n=e.response&&e.response.headers.get("Location");n&&t(`<script>window.location="${n}"<\/script>`)}}function ct(e,t={}){return it(e,{...t,createPageEvent:z})}const lt=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],ut=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"],gt=ct(()=>p(nt,{document:({assets:e,children:t,scripts:n})=>y(ut,$(),p(H,{get children(){return y(lt,b(e))}}),b(t),b(n))}));export{gt as default};
